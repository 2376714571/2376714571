<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>我的博客</title>
      <link href="/2020/06/23/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
      <url>/2020/06/23/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
      
        <content type="html"><![CDATA[<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">import</span> time,logging</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_driver</span><span class="params">()</span>:</span></span><br><span class="line">  chromedriver = <span class="string">r"C:\Program Files (x86)\Google\Chrome\Application\chromedriver.exe"</span></span><br><span class="line">   driver = webdriver.Chrome(chromedriver)</span><br><span class="line">   <span class="keyword">return</span> driver</span><br></pre></td></tr></table></figure></code></pre><a id="more"></a><pre><code><figure class="highlight plain"><figcaption><span>login_qq(driver, login_page, username, password):</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">   driver.get(login_page)</span><br><span class="line">   iframe &#x3D; driver.find_element_by_xpath(&quot;&#x2F;&#x2F;iframe[@id]&quot;)</span><br><span class="line">   driver.switch_to.frame(iframe)</span><br><span class="line">   try:</span><br><span class="line">       WebDriverWait(driver, 5).until(</span><br><span class="line">           EC.element_to_be_clickable((By.ID, &quot;switcher_plogin&quot;))</span><br><span class="line">       )</span><br><span class="line">   except Exception as e:</span><br><span class="line">       logging.exception(e)</span><br><span class="line">       pass</span><br><span class="line">   driver.find_element_by_id(&quot;switcher_plogin&quot;).click()  # 切换到qq登录输入框</span><br><span class="line">   # 用户名</span><br><span class="line">   username_input &#x3D; driver.find_element_by_id(&quot;u&quot;)</span><br><span class="line">   username_input.clear()</span><br><span class="line">   username_input.send_keys(username)</span><br><span class="line">   # 密码</span><br><span class="line">   password_input &#x3D; driver.find_element_by_id(&quot;p&quot;)</span><br><span class="line">   password_input.clear()</span><br><span class="line">   password_input.send_keys(password)</span><br><span class="line">   before_url &#x3D; driver.current_url  # 记录地址栏url</span><br><span class="line">   # 点击登录</span><br><span class="line">   driver.find_element_by_id(&quot;login_button&quot;).click()</span><br><span class="line">   time.sleep(2)</span><br><span class="line">   if driver.current_url &#x3D;&#x3D; before_url:  # 如果url没有改变,则判定登录失败</span><br><span class="line">       # 登录不成功</span><br><span class="line">       print(&quot;登录失败,正在重试&quot;)</span><br><span class="line">       login_qq(driver, login_page,username,password)</span><br><span class="line">   return &quot;seccess&quot;</span><br><span class="line">def like_music(driver,music_page):</span><br><span class="line">   driver.get(music_page)</span><br><span class="line">   driver.switch_to.frame(&#39;g_iframe&#39;)</span><br><span class="line">   time.sleep(2)</span><br><span class="line">   while True:</span><br><span class="line">       comments &#x3D; driver.find_element_by_id(&#39;comment-box&#39;).find_elements_by_css_selector(&#39;.itm&#39;) #获取所有评论item元素</span><br><span class="line">       for item in comments:</span><br><span class="line">           try:</span><br><span class="line">               target &#x3D; driver.find_element_by_xpath(&#39;&#x2F;&#x2F;a[@data-type&#x3D;&quot;like&quot;]&#39;) #筛选出未点赞的元素</span><br><span class="line">               driver.execute_script(&quot;arguments[0].scrollIntoView();&quot;, target)  #拖动到可见的元素处</span><br><span class="line">               target.click() #点赞</span><br><span class="line">               time.sleep(0.4)</span><br><span class="line">           except Exception as e:</span><br><span class="line">               logging.exception(e)</span><br><span class="line">               pass</span><br><span class="line">       next_btn&#x3D;driver.find_element_by_link_text(&quot;下一页&quot;) # 评论翻页</span><br><span class="line">       if &quot;disable&quot; in next_btn.get_attribute(&quot;class&quot;): #判断class属性中是否包含disabled字段</span><br><span class="line">           print(&quot;点赞完毕&quot;)</span><br><span class="line">           break</span><br><span class="line">       next_btn.click()</span><br><span class="line">       time.sleep(1)</span><br><span class="line">   return &quot;over&quot;</span><br><span class="line"></span><br><span class="line">login_page&#x3D;&quot;https:&#x2F;&#x2F;graph.qq.com&#x2F;oauth&#x2F;show?which&#x3D;Login&amp;display&#x3D;pc&amp;client_id&#x3D;100495085&amp;response_type&#x3D;code&amp;redirect_uri&#x3D;https:&#x2F;&#x2F;music.163.com&#x2F;back&#x2F;qq&amp;forcelogin&#x3D;true&amp;state&#x3D;ZwKHpxUoam&quot;</span><br><span class="line">driver &#x3D; get_driver()</span><br><span class="line">try:</span><br><span class="line">   login_qq(driver, login_page, &quot;qq_username&quot;, &quot;qq_password&quot;) #登录</span><br><span class="line">except Exception as e:</span><br><span class="line">   logging.exception(e)</span><br><span class="line">   pass</span><br><span class="line">driver.refresh()</span><br><span class="line">music_page&#x3D;&quot;http:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;song?id&#x3D;32358440&quot;</span><br><span class="line">like_music(driver,music_page) #点赞</span><br></pre></td></tr></table></figure></code></pre>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
